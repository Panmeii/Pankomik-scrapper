<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 id="title">Loading...</h1>
    <div class="nav-buttons">
        <a id="prev" href="#" class="disabled">⬅ Prev</a>
        <a id="next" href="#" class="disabled">Next ➡</a>
    </div>
    <div id="images"></div>

    <script>
    const apiBase = "https://kurokamiapi-panmei.vercel.app/api/chapter/";
    const urlParams = new URLSearchParams(window.location.search);
    const chapterId = urlParams.get("chapterid");

    if (!chapterId) {
        console.error("❌ Error: Chapter ID tidak ditemukan di URL.");
    } else {
        fetch(apiBase + chapterId)
            .then(response => response.json())
            .then(data => {
                if (!data || !data.images || data.images.length === 0) {
                    console.error("❌ Error: Data chapter kosong atau tidak valid.", data);
                    document.getElementById("title").textContent = "Chapter tidak ditemukan!";
                    return;
                }

                // ✅ **Tampilkan gambar dengan benar**
                document.getElementById("title").textContent = data.title;
                const imagesDiv = document.getElementById("images");
                imagesDiv.innerHTML = ""; 

                data.images.forEach(imgSrc => {
                    const img = document.createElement("img");
                    img.src = imgSrc;
                    img.loading = "lazy"; // Supaya lebih ringan
                    imagesDiv.appendChild(img);
                });

                // ✅ **Atur tombol Next & Prev dengan aman**
                setupNavigationButtons(chapterId);
            })
            .catch(error => {
                console.error("❌ Gagal mengambil data chapter:", error);
                document.getElementById("title").textContent = "Error: Gagal memuat chapter.";
            });
    }

    function setupNavigationButtons(chapterId) {
        const prevButton = document.getElementById("prev");
        const nextButton = document.getElementById("next");

        // 📌 **Ambil nama manhwa & nomor chapter**
        const match = chapterId.match(/(.*)-chapter-(\d+)/);
        if (!match) {
            console.error("❌ Error: Format chapter ID tidak sesuai!", chapterId);
            return;
        }

        const manhwaTitle = match[1];
        const chapterNumber = parseInt(match[2]);

        // ✅ **Setup tombol Previous**
        if (chapterNumber > 1) {
            prevButton.href = `chapter.html?chapterid=${manhwaTitle}-chapter-${chapterNumber - 1}`;
            prevButton.classList.remove("disabled");
        } else {
            prevButton.classList.add("disabled");
        }

        // ✅ **Cek apakah Next Chapter tersedia sebelum mengaktifkan tombol**
        const nextChapterId = `${manhwaTitle}-chapter-${chapterNumber + 1}`;
        fetch(apiBase + nextChapterId)
            .then(response => {
                if (!response.ok) throw new Error("🚫 Chapter terakhir!");
                return response.json();
            })
            .then(nextData => {
                if (nextData && nextData.images && nextData.images.length > 0) {
                    nextButton.href = `chapter.html?chapterid=${nextChapterId}`;
                    nextButton.classList.remove("disabled");
                } else {
                    throw new Error("🚫 Tidak ada chapter berikutnya.");
                }
            })
            .catch(() => {
                nextButton.href = `detail.html?manhwaid=${manhwaTitle}`;
                nextButton.textContent = "🔙 Kembali ke Detail";
                nextButton.classList.remove("disabled");
            });
    }
    </script>
</body>
</html>
